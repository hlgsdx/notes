# 进程关系

### Linux与UNIX强亲缘关系

1. 如果子进程终止，父进程没有回收，会产生僵尸进程（内存泄漏）

2. 如果父进程先于子进程终止，称为孤儿进程，会被init收养（进程运行存在风险，不可控制）

### 如何获取一个终端

//TODO:ADD PIC

### 网络终端设备(伪终端主设备/)

//ADD PIC

## 进程组

进程组与亲缘关系没有必然联系

进程组的生命周期：直到最后一个进程终止或离开，进程组才被释放

​	当前组中有其他进程，或者当前组中有其他组的组长，组长和组员都可以跳转到其他组

守护进程/精灵进程

守护进程生命周期较长（随系统持续），持续在后台工作，周期性完成任务

#### 让进程脱离终端运行

sid会话ID

结束终端时相同会话ID的进程都会结束。

回话的发起者 pid = gid = sid

​	脱离原有会话是脱离终端的第一步

| APP   | PID  | GID  | SID  |
| ----- | ---- | ---- | ---- |
| bash  | 1000 | 1000 | 1000 |
| app父 | 2000 | 2000 | 1000 |
| app子 | 2001 | 2000 | 1000 |

### 创建守护进程7步走

1. 创建子进程，父进程终止

   `fork exit`

2. 子进程脱离控制终端  `setsid`

3. 子进程修改工作路径到 `/`  `chdir("/")`

4. 子进程修改umask权限掩码  `umask(0)`

5. 子进程关闭无用的fd `close(STDIN_FILENO)` `close(STOUT_FILENO)`

6. 守护进程核心工作 

   1. 在`/tmp`目录下创建`file.log`文件

   2. 守护进程每隔五秒向该文件中写入当然时间，时间精确到微秒级

7. 守护进程退出处理

